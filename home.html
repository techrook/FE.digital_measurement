<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Measurements</title>
    <link rel="stylesheet" href="home.css" />
  </head>
  <body>
    <div class="container">
      <h1>My Designs</h1>
      <div id="designsContainer"></div>
      <p id="info"></p>
      <button id="add_measurement_button">Add Measurement</button>
    </div>

    <script>
      const container_info = document.getElementById("info");
      document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("token");
        if (!token) {
          window.location.href = "login.html"; // Redirect to login page
          return;
        }
        fetchDesigns(token);
      });

      const add_measurement_button = document.getElementById(
        "add_measurement_button"
      );
      add_measurement_button.addEventListener("click", function () {
        window.location.href = "addmeasurement.html";
      });

      function fetchDesigns(token) {
        fetch("http://localhost:3333/measurement/", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`, // Include the token in the Authorization header
          },
        })
          .then((response) => response.json())
          .then((data) => {
            const container = document.getElementById("designsContainer");
            container.innerHTML = "";
            if (data.length === 0) {
              const message = document.createElement("p");
              message.textContent = "No designs available.";
              container.appendChild(message);
            } else {
              data.forEach((design) => {
                container.appendChild(createDesignCard(design));
              });
            }
          })
          .catch((error) => console.error("Error fetching designs:", error));
      }

      function createDesignCard(design) {
        const card = document.createElement("div");
        card.className = "design-card";

        const image = document.createElement("img");
        image.src = design.dress_design;
        image.alt = `Design for ${design.cloth_Owner_name}`;

        const info = document.createElement("div");
        info.className = "design-info";
        info.innerHTML = `
                <h3>${design.cloth_Owner_name}'s Design</h3>
                <p>Gender: ${design.gender}</p>
                <p>Chest: ${design.chest} | Waist: ${design.Waist} | Hip: ${design.Hips}</p>
                <p>Ankle: ${design.ankle} | Lap: ${design.laps} | Neck: ${design.neck}</p>
                <p>Neck to waist: ${design.neck_to_waist} | shoulder: ${design.shoulders} | wrist: ${design.wrist} </p>
                <p>Waist down to desired length: ${design.waist_down_to_desired_lenght} </p>

            `;

        const editButton = document.createElement("button");
        editButton.textContent = "Edit";
        editButton.addEventListener("click", function () {
          // Handle edit functionality here
        });

        const deleteButton = document.createElement("button");
        deleteButton.textContent = "Delete";
        deleteButton.addEventListener("click", async function () {
          const token = localStorage.getItem("token");
          try {
            const response = await fetch(
              `http://localhost:3333/measurement/${design.id}`,
              {
                method: "DELETE",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
              }
            );
            const data = await response.json();
            if (response.ok) {
              // Remove the design card from the UI
              await card.remove();
              await window.location.reload();
              return;
            } else {
              // const container_info = document.getElementById('info');
              container_info.innerHTML = `error, design not deleted${data.message} `;
            }
          } catch (error) {
            console.error(error);
          }
        });

        card.appendChild(image);
        card.appendChild(info);
        card.appendChild(editButton);
        card.appendChild(deleteButton);

        return card;
      }
    </script>
  </body>
</html>
